<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Friend Finder Survey</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

</head>
<body>
<div class="container">
  <div class="row">
    <div class="jumbotron">
      <h1 class="text-center"><span class="glyphicon glyphicon-globe"></span>Friend Finder</h1>
      <hr>
      <h2 class="text-center">Take the Survey to get paired with a new friend!</h2>
      <h4 class="text-center">On a scale of 1 to 5 with 5 being the agree and 1 being disagree, how much do you believe these statements apply to you.</h4>
      <h4 class="text-center">After you are done, click submit and you will see your new friend!</h4>
      <br>
      
      <div class="text-center">
        <a href="/reserve"><button type="button" class="btn btn-lg btn-danger"><span class="glyphicon glyphicon-credit-card"></span> </button></a>
        <a href="/"><button type="button" class="btn btn-lg btn-default"><span class="glyphicon glyphicon-home"></span></button></a>
      </div>
    </div>
    <div class="col-lg-12">
      <div class="panel panel-default">
        <div class="panel-heading">
          <h2 class="panel-title"><span class="glyphicon glyphicon-search"></span>Survey Questions</h2>
        </div>
        <div class="panel-body" id="questions">
        <form>
          <div class="form-group">
            <label for="name">Name (Required)</label>
            <input type="name" class="form-control" id="name_input" placeholder="Name">
          </div>
          <div class="form-group">
            <label for="imageLink">Link to a Photo Image (Required)</label>
            <input type="imageLink" class="form-control" id="imageLink_input" placeholder="Link to a Photo Image">
          </div>
          <h4>Questions 1</h4>
          <p>Being mean to people is fun.</p>
          <select class="form-control" id="question1">
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
          </select>
          <h4>Questions 2</h4>
          <p>You are happier when spending time with a large group of people.</p>
          <select class="form-control" id="question2">
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
          </select>
          <h4>Questions 3</h4>
          <p>You enjoy solving puzzles.</p>
          <select class="form-control" id="question3">
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
          </select>
          <h4>Questions 4</h4>
          <p>You prefer to spend time by yourself.</p>
          <select class="form-control" id="question4">
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
          </select>
          <h4>Questions 5</h4>
          <p>You are respectful of others beliefs.</p>
          <select class="form-control" id="question5">
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
          </select>
          <h4>Questions 6</h4>
          <p>You are an overachiever.</p>
          <select class="form-control" id="question6">
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
          </select>
          <h4>Questions 7</h4>
          <p>You enjoy being the center of attention.</p>
          <select class="form-control" id="question7">
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
          </select>
          <h4>Questions 8</h4>
          <p>You worry about what people think of you.</p>
          <select class="form-control" id="question8">
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
          </select>
          <h4>Questions 9</h4>
          <p>You enjoy doing something creative.</p>
          <select class="form-control" id="question9">
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
          </select>
          <h4>Questions 10</h4>
          <p>You enjoy being active.</p>
          <select class="form-control" id="question10">
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
          </select>
          <br>
          <button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal" id="submit"><span class="glyphicon glyphicon-check"></span>Submit</button>
         </form> 
  <!-- Modal -->
  <div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Your New Friend is:</h4>
        </div>
        <div class="modal-body">
          <p id="modalText"></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
      
    </div>
  </div>
        </div>
      </div>
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p>Friend Finder</p>
    <p><a href="#" id="clear">API Friend List</a> | <a href="https://github.com/emilypo89/FriendFinders">GitHub Repo</a>
  </div>
</footer>



</body>
</html>

<script type="text/javascript">

    // In this code below we create the Front-end JavaScript which "POSTS" our form data to our express server.

    $("#submit").on("click", function(event) {
      event.preventDefault();
      // Here grab the form elements
      var newFriend = {
        name: $("#name_input").val().trim(),
        photo: $("#imageLink_input").val().trim(),
        scores: [parseInt($("#question1").val().trim()), parseInt($("#question2").val().trim()), parseInt($("#question3").val().trim()), parseInt($("#question4").val().trim()), parseInt($("#question5").val().trim()), parseInt($("#question6").val().trim()), parseInt($("#question7").val().trim()), parseInt($("#question8").val().trim()), parseInt($("#question9").val().trim()), parseInt($("#question10").val().trim())]
      };

      console.log(newFriend);

      // This line is the magic. It"s very similar to the standard ajax function we used.
      // Essentially we give it a URL, we give it the object we want to send, then we have a "callback".
      // The callback is the response of the server. In our case, we set up code in api-routes that "returns" true or false
      // depending on if a tables is available or not.

      $.post("/api/friends", newFriend,
        function(data) {
          $("#name_input").val("");
          $("#imageLink_input").val("");
          $(".form-control").val("");
          $("#modalText").html("");

        });
      // Here we get the location of the root page.
        // We use this instead of explicitly saying the URL is localhost:3001 because the url will change when we deploy.
        var currentURL = window.location.origin;

        // The AJAX function uses the URL of our API to GET the data associated with it (initially set to localhost)
        $.ajax({url: currentURL + "/api/match", method: "GET"})
            .done(function(matchData) {

                // Here we are logging the URL so we have access to it for troubleshooting
                console.log("------------------------------------");
                console.log("URL: " + currentURL + "/api/friends");
                console.log("------------------------------------");

                // Here we then log the Data to console, where it will show up as an object.
                console.log("matchData: " + matchData);
                console.log(matchData[0].name);
                console.log("------------------------------------");

             // var tableSection = $("<div>");
             //    tableSection.addClass('well');
             //    tableSection.attr('id', 'tableWell-' + i+1)
             //    $('#tableSection').append(tableSection);

             //    var tableNumber = i + 1;


                // Then display the remaining fields in the HTML (Section Name, Date, URL)
                $("#modalText").html("<h2>" + matchData[0].name + "\n</h2>" + "<img src=" + matchData[0].photo + ">");

             
            });

    });

</script>